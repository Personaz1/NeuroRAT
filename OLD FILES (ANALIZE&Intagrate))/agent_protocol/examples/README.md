# Примеры использования протокола агентской коммуникации

В этой директории содержатся примеры интеграции агентского протокола с различными приложениями.

## Обзор примеров

### 1. Базовая интеграция с агентом (agent_integration.py)

Демонстрирует, как интегрировать наш протокол с существующим каркасом агента для создания защищенного соединения с сервером.

Основные возможности:
- Шифрованная коммуникация
- Автоматическое подключение и переподключение к серверу
- Динамическая загрузка модулей
- Выполнение задач, полученных от сервера
- Сбор и отправка системной информации

### 2. Серверный обработчик (server_handler.py)

Пример реализации серверной части для управления агентами и обработки их сообщений.

Основные возможности:
- Управление подключенными агентами
- Хранение информации о состоянии агентов
- Добавление задач в очередь для конкретных агентов
- Получение и хранение результатов выполнения задач
- Отправка модулей агентам по запросу

### 3. Пример модуля (example_module.py)

Пример модуля для агента, который собирает расширенную информацию о системе.

Основные функции:
- Сбор информации о процессоре, памяти и операционной системе
- Анализ сетевых интерфейсов и IP-адресов
- Мониторинг активных процессов
- Информация о дисковом пространстве

## Как использовать примеры

### Запуск сервера

1. Запустите сервер:
   ```bash
   python examples/server_handler.py --host 0.0.0.0 --port 8765
   ```

2. Обратите внимание на выведенный ключ шифрования (base64). Он понадобится для подключения агентов.

### Запуск агента

1. Скопируйте пример модуля в директорию modules:
   ```bash
   mkdir -p modules
   cp examples/example_module.py modules/
   ```

2. Запустите агента, указав ключ шифрования от сервера:
   ```bash
   ENCRYPTION_KEY="base64:ключ_полученный_от_сервера" SERVER_HOST="ip_сервера" python examples/agent_integration.py
   ```

### Наблюдение за результатами

1. На сервере будет отображаться информация о подключенных агентах
2. Каждые 5 минут сервер будет отправлять задачи агентам
3. Агенты будут выполнять полученные задачи и отправлять результаты
4. Логи сервера и агента содержат подробную информацию о происходящем

## Настройка

### Серверные опции

- `--host` - Хост для привязки (по умолчанию: 0.0.0.0)
- `--port` - Порт для прослушивания (по умолчанию: 8765)
- `--encryption-key` - Ключ шифрования (текстовый или base64)
- `--use-ssl` - Использовать SSL (флаг)
- `--cert-file` - Файл сертификата SSL
- `--key-file` - Файл ключа SSL

### Агентские переменные окружения

- `AGENT_ID` - Идентификатор агента (по умолчанию: генерируется)
- `SERVER_HOST` - Хост сервера (по умолчанию: localhost)
- `SERVER_PORT` - Порт сервера (по умолчанию: 8765)
- `ENCRYPTION_KEY` - Ключ шифрования (текстовый или base64)
- `HEARTBEAT_INTERVAL` - Интервал между отправками отчетов (секунды, по умолчанию: 60)

## Создание собственных модулей

Для создания нового модуля, создайте Python-файл в директории `modules` с функцией `run()`:

```python
def run(**params):
    """
    Основная функция модуля.
    
    Параметры:
    - **params: словарь с параметрами от сервера
    
    Возвращает:
    - Словарь с результатами
    """
    return {
        "status": "success",
        "data": "Результат выполнения модуля"
    }
```

Сервер сможет отправлять этот модуль агентам и получать результаты его выполнения. 